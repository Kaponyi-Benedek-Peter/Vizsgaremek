import{b as B}from"./chunk-GTAVLBOO.js";import{e as L,g as I,k as V,n as T,p as j}from"./chunk-SISV7ZTJ.js";import{$ as _,$a as v,$b as k,Ba as o,Ja as g,Jb as c,Kb as l,Oa as P,S as M,Z as E,_ as C,_a as u,aa as x,dc as O,ib as t,ja as p,jb as r,kb as f,lb as y,ob as S,pb as b,wb as s,xb as m,yb as w}from"./chunk-F6XLXXZ5.js";function N(n,a){n&1&&(t(0,"div",2),f(1,"div",3),t(2,"h1"),s(3),c(4,"translate"),r(),t(5,"p",4),s(6),c(7,"translate"),r()()),n&2&&(o(3),m(l(4,2,"auth.login_promise.verifying")),o(3),m(l(7,4,"auth.login_promise.please_wait")))}function z(n,a){n&1&&(t(0,"div",2)(1,"div",5),_(),t(2,"svg",6),f(3,"path",7),r()(),x(),t(4,"h1"),s(5),c(6,"translate"),r(),t(7,"p",4),s(8),c(9,"translate"),r()()),n&2&&(o(5),m(l(6,2,"auth.login_promise.success_title")),o(3),m(l(9,4,"auth.login_promise.success_message")))}function U(n,a){if(n&1){let e=y();t(0,"div",2)(1,"div",8),_(),t(2,"svg",6),f(3,"path",9),r()(),x(),t(4,"h1"),s(5),c(6,"translate"),r(),t(7,"p",10),s(8),c(9,"translate"),r(),t(10,"button",11),S("click",function(){E(e);let d=b();return C(d.backToLogin())}),s(11),c(12,"translate"),r()()}if(n&2){let e=b();o(5),m(l(6,3,"auth.login_promise.error_title")),o(3),m(l(9,5,e.errorMessage())),o(3),w(" ",l(12,7,"auth.login_promise.back_to_login")," ")}}var R=class n{constructor(a,e,i){this.route=a;this.router=e;this.authService=i}location=M(k);isVerifying=p(!1);isSuccess=p(!1);errorMessage=p("");ngOnInit(){this.route.queryParams.subscribe(a=>{let e=a.login_promise;if(!e){this.errorMessage.set("auth.errors.invalid_login_link");return}let i=e.split(";");if(i.length!==2){this.errorMessage.set("auth.errors.invalid_login_link");return}let d=i[0].trim(),h=i[1].trim();if(!d||!h){this.errorMessage.set("auth.errors.invalid_login_link");return}let A=`/login-promise?login_promise=${d};${h}`;this.location.replaceState(A);let D=sessionStorage.getItem("login_stay")==="1";sessionStorage.removeItem("login_stay"),this.completeLogin(d,h,D)})}completeLogin(a,e,i){this.isVerifying.set(!0),this.errorMessage.set(""),this.authService.loginPromise(a,e,i).subscribe({next:()=>{this.isVerifying.set(!1),this.isSuccess.set(!0)},error:d=>{this.isVerifying.set(!1),this.errorMessage.set(d.message||"auth.errors.login_failed")}})}backToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(g(L),g(I),g(B))};static \u0275cmp=P({type:n,selectors:[["app-login-promise"]],decls:5,vars:3,consts:[[1,"auth-container"],[1,"auth-card"],[1,"verification-content"],[1,"spinner-large"],[1,"verification-text"],[1,"icon-wrapper","success"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["stroke-linecap","round","stroke-linejoin","round","d","M5 13l4 4L19 7"],[1,"icon-wrapper","error"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"verification-text","error-text"],[1,"submit-btn",3,"click"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"div",1),u(2,N,8,6,"div",2),u(3,z,10,6,"div",2),u(4,U,13,9,"div",2),r()()),e&2&&(o(2),v(i.isVerifying()?2:-1),o(),v(!i.isVerifying()&&i.isSuccess()?3:-1),o(),v(!i.isVerifying()&&i.errorMessage()?4:-1))},dependencies:[O,V,j,T],styles:[".auth-container[_ngcontent-%COMP%]{min-height:calc(100vh - 140px);display:flex;align-items:center;justify-content:center;padding:var(--space-6) var(--space-4);background:var(--bg-secondary)}.auth-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-xl);box-shadow:var(--shadow-lg);padding:var(--space-10) var(--space-8);width:100%;max-width:480px;animation:_ngcontent-%COMP%_slideUp .4s ease-out}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.verification-content[_ngcontent-%COMP%]{text-align:center}.verification-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:clamp(1.25rem,3vw,1.6rem);font-weight:700;color:var(--text-primary);margin:var(--space-5) 0 var(--space-3)}.verification-text[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:var(--text-base, 1rem);line-height:1.6;margin-bottom:var(--space-6)}.error-text[_ngcontent-%COMP%]{color:#dc2626}.icon-wrapper[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;margin:0 auto var(--space-4);display:flex;align-items:center;justify-content:center}.icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:40px;height:40px}.icon-wrapper.success[_ngcontent-%COMP%]{background:#067a451f;color:#067a45}.icon-wrapper.error[_ngcontent-%COMP%]{background:#dc26261a;color:#dc2626}.spinner-large[_ngcontent-%COMP%]{width:56px;height:56px;border:4px solid var(--border-color);border-top-color:var(--color-primary);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin:0 auto var(--space-5)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.submit-btn[_ngcontent-%COMP%]{width:100%;padding:var(--space-3) var(--space-6);background:linear-gradient(135deg,#067a45,#048a4f);color:#fff;border:none;border-radius:var(--radius-lg);font-size:var(--text-base, 1rem);font-weight:600;cursor:pointer;transition:all var(--transition-fast, .15s);min-height:48px;margin-top:var(--space-2)}.submit-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #067a4566}"]})};export{R as LoginPromise};
