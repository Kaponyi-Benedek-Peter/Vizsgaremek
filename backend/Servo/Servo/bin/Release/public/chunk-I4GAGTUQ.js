import{b as x,m as T,q as v}from"./chunk-DXTRCEFC.js";import{K as C,Mb as s,N as p,R as O,S as c,a as d,b as _,c as L,da as D,h as I,ja as o,k as b,l as z,o as F,p as N,q as h,y as f}from"./chunk-33H2QBHE.js";var m=class i{constructor(e){this.translate=e;this.initLanguage()}currentLangSubject=new I("en");currentLang$=this.currentLangSubject.asObservable();initLanguage(){let t=["hu","en","de"];this.translate.addLangs(t),this.translate.setDefaultLang("en");let r=this.getSavedLanguage()||"en";this.setLanguage(r)}setLanguage(e){this.translate.use(e),this.currentLangSubject.next(e),this.saveLanguage(e)}getCurrentLanguage(){return this.currentLangSubject.value}saveLanguage(e){localStorage.setItem("preferredLanguage",e)}getSavedLanguage(){return localStorage.getItem("preferredLanguage")}instant(e){return this.translate.instant(e)}static \u0275fac=function(t){return new(t||i)(O(T))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};function j(i,e){let n=!e?.manualCleanup?e?.injector?.get(D)??c(D):null,r=B(e?.equal),a;e?.requireSync?a=o({kind:0},{equal:r}):a=o({kind:1,value:e?.initialValue},{equal:r});let l,y=i.subscribe({next:u=>a.set({kind:1,value:u}),error:u=>{a.set({kind:2,error:u}),l?.()},complete:()=>{l?.()}});if(e?.requireSync&&a().kind===0)throw new C(601,!1);return l=n?.onDestroy(y.unsubscribe.bind(y)),s(()=>{let u=a();switch(u.kind){case 1:return u.value;case 2:throw u.error;case 0:throw new C(601,!1)}},{equal:e?.equal})}function B(i=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&i(e.value,t.value)}var S=class i{translationService=c(m);currentLang=j(this.translationService.currentLang$,{initialValue:"en"});currencyMap={hu:{code:"HUF",symbol:"Ft",locale:"hu-HU"},en:{code:"USD",symbol:"$",locale:"en-US"},de:{code:"EUR",symbol:"\u20AC",locale:"de-DE"}};currentCurrency=s(()=>{let e=this.currentLang();return this.currencyMap[e]});formatPrice(e){let t=this.currentCurrency(),n=e.toLocaleString(t.locale,{minimumFractionDigits:0,maximumFractionDigits:2});return t.code==="HUF"?`${n} ${t.symbol}`:`${t.symbol}${n}`}getCurrencyForLanguage(e){return this.currencyMap[e]}getCurrentCurrencyCode(){return this.currentCurrency().code}getCurrentCurrencySymbol(){return this.currentCurrency().symbol}static \u0275fac=function(t){return new(t||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};function w(i,e="hu"){let t=parseFloat(i.price_huf)||0,n=parseFloat(i.stock)||0,r=parseFloat(i.sale_percentage)||0,a=parseFloat(i.rating)||0,l=n>0,y=r>0,u=!1,R=y?t*(1-r/100):t,P=i.name||"",k="";switch(e){case"hu":P=i.name_hu||i.name,k=i.description_hu;break;case"en":P=i.name_en||i.name,k=i.description_en;break;case"de":P=i.name_de||i.name,k=i.description_de;break}return _(d({},i),{name:P,priceNumber:t,stockNumber:n,salePercentageNumber:r,ratingNumber:a,inStock:l,hasDiscount:y,requiresPrescription:u,price:R,discountPercentage:r,stockQuantity:n,reviewCount:0,nameHu:i.name_hu,nameEn:i.name_en,nameDe:i.name_de,description:k,descriptionHu:i.description_hu,descriptionEn:i.description_en,descriptionDe:i.description_de,activeIngredients:i.active_ingredients,imageUrl:`${v.assetsURL}/assets/images/products/${i.id||"placeholder"}.webp`,images:[`${v.assetsURL}/assets/images/products/${i.id||"placeholder"}.webp`,`${v.assetsURL}/assets/images/products/${i.id||"placeholder"}-2.webp`,`${v.assetsURL}/assets/images/products/${i.id||"placeholder"}-3.webp`],dosage:void 0})}var g=[{id:"1",name_de:"Algopyrin 500mg Tabletten",name_hu:"Algopyrin 500mg Tabletta",name_en:"Algopyrin 500mg Tablets",description_de:"Schmerzlinderung und Fiebersenkung f\xFCr Kopfschmerzen, Muskelschmerzen und Fieber.",description_hu:"F\xE1jdalomcsillap\xEDt\xF3 \xE9s l\xE1zcsillap\xEDt\xF3 tabletta fejf\xE1j\xE1s, izomf\xE1jdalom \xE9s l\xE1z eset\xE9n.",description_en:"Pain relief and fever reducing tablets for headache, muscle pain and fever.",description_preview_de:"Schmerzlinderung und Fiebersenkung",description_preview_hu:"F\xE1jdalomcsillap\xEDt\xF3 \xE9s l\xE1zcsillap\xEDt\xF3",description_preview_en:"Pain relief and fever reducing",price_huf:"2490",price_usd:"7",price_eur:"6",times_ordered:"156",stock:"45",sale_percentage:"15",category:"medicine",manufacturer:"Richter Gedeon",brand:"Algopyrin",rating:"4.5",sku:"ALG-500-20",active_ingredients:"Metamizol-n\xE1trium",packaging:"20 tabletta",created_at:"2024-01-15",updated_at:"2024-02-10",name:"Algopyrin 500mg"},{id:"2",name_de:"Aspirin Plus C Brausetabletten",name_hu:"Aspirin Plus C Pezsg\u0151tabletta",name_en:"Aspirin Plus C Effervescent",description_de:"Schnelle Linderung bei Erk\xE4ltung und Grippe mit Vitamin C.",description_hu:"Gyors megk\xF6nnyebb\xFCl\xE9s megf\xE1z\xE1s \xE9s influenza eset\xE9n C-vitaminnal.",description_en:"Fast relief for cold and flu with Vitamin C.",description_preview_de:"Erk\xE4ltungs- und Grippemittel",description_preview_hu:"Megf\xE1z\xE1s \xE9s influenza elleni szer",description_preview_en:"Cold and flu relief",price_huf:"3490",price_usd:"10",price_eur:"9",times_ordered:"230",stock:"30",sale_percentage:"10",category:"medicine",manufacturer:"Bayer",brand:"Aspirin",rating:"4.7",sku:"ASP-C-10",active_ingredients:"Acetilszalicilsav, Aszkorbinsav",packaging:"10 pezsg\u0151tabletta",created_at:"2024-01-20",updated_at:"2024-02-15",name:"Aspirin Plus C"},{id:"3",name_de:"Bepanthen Wund- und Heilsalbe",name_hu:"Bepanthen Sebgy\xF3gy\xEDt\xF3 Kr\xE9m",name_en:"Bepanthen Wound Healing Ointment",description_de:"Unterst\xFCtzt die Wundheilung und Regeneration der Haut.",description_hu:"T\xE1mogatja a sebgy\xF3gyul\xE1st \xE9s a b\u0151r regener\xE1l\xF3d\xE1s\xE1t.",description_en:"Supports wound healing and skin regeneration.",description_preview_de:"Wundheilung und Hautregeneration",description_preview_hu:"Sebgy\xF3gyul\xE1s \xE9s b\u0151r regener\xE1ci\xF3",description_preview_en:"Wound healing and skin regeneration",price_huf:"2890",price_usd:"8",price_eur:"7",times_ordered:"189",stock:"50",sale_percentage:"0",category:"cosmetics",manufacturer:"Bayer",brand:"Bepanthen",rating:"4.8",sku:"BEP-50G",active_ingredients:"Dexpantenol",packaging:"50g kr\xE9m",created_at:"2024-01-25",updated_at:"2024-02-20",name:"Bepanthen"},{id:"4",name_de:"Voltaren Schmerzgel",name_hu:"Voltaren F\xE1jdalomcsillap\xEDt\xF3 G\xE9l",name_en:"Voltaren Pain Relief Gel",description_de:"Entz\xFCndungshemmendes Gel f\xFCr Muskel- und Gelenkschmerzen.",description_hu:"Gyullad\xE1scs\xF6kkent\u0151 g\xE9l izom- \xE9s \xEDz\xFCleti f\xE1jdalmakra.",description_en:"Anti-inflammatory gel for muscle and joint pain.",description_preview_de:"Gegen Muskel- und Gelenkschmerzen",description_preview_hu:"Izom- \xE9s \xEDz\xFCleti f\xE1jdalmak ellen",description_preview_en:"For muscle and joint pain",price_huf:"4290",price_usd:"12",price_eur:"11",times_ordered:"312",stock:"25",sale_percentage:"20",category:"medicine",manufacturer:"Novartis",brand:"Voltaren",rating:"4.6",sku:"VOL-100G",active_ingredients:"Diklofenak",packaging:"100g g\xE9l",created_at:"2024-02-01",updated_at:"2024-02-25",name:"Voltaren"},{id:"5",name_de:"Vitamin C 1000mg Tabletten",name_hu:"C-vitamin 1000mg Tabletta",name_en:"Vitamin C 1000mg Tablets",description_de:"Hochdosiertes Vitamin C zur St\xE4rkung des Immunsystems.",description_hu:"Magas d\xF3zis\xFA C-vitamin az immunrendszer er\u0151s\xEDt\xE9s\xE9re.",description_en:"High dose Vitamin C to strengthen the immune system.",description_preview_de:"Immunsystem-St\xE4rkung",description_preview_hu:"Immunrendszer er\u0151s\xEDt\xE9s",description_preview_en:"Immune system support",price_huf:"3490",price_usd:"10",price_eur:"9",times_ordered:"445",stock:"142",sale_percentage:"0",category:"vitamins",manufacturer:"Pharma Nord",brand:"Bio-C",rating:"4.9",sku:"VITC-1000-60",active_ingredients:"Aszkorbinsav",packaging:"60 tabletta",created_at:"2024-01-10",updated_at:"2024-03-01",name:"Vitamin C 1000mg"},{id:"6",name_de:"D3-Vitamin 2000NE Tropfen",name_hu:"D3-vitamin 2000NE Cseppek",name_en:"Vitamin D3 2000IU Drops",description_de:"Vitamin D3 Tropfen f\xFCr Knochen und Immunsystem.",description_hu:"D3-vitamin cseppek a csontok \xE9s immunrendszer t\xE1mogat\xE1s\xE1ra.",description_en:"Vitamin D3 drops for bones and immune system.",description_preview_de:"Knochen und Immunsystem",description_preview_hu:"Csontok \xE9s immunrendszer",description_preview_en:"Bones and immune system",price_huf:"2990",price_usd:"8",price_eur:"7",times_ordered:"367",stock:"87",sale_percentage:"5",category:"vitamins",manufacturer:"Pharma Nord",brand:"Bio-D3",rating:"4.7",sku:"VITD3-2000-30ML",active_ingredients:"Kolekalciferol",packaging:"30ml cseppek",created_at:"2024-01-12",updated_at:"2024-03-05",name:"D3-vitamin 2000NE"},{id:"7",name_de:"Probiotikum Komplex Kapseln",name_hu:"Probiotikum Komplex Kapszula",name_en:"Probiotic Complex Capsules",description_de:"Multi-Stamm Probiotikum f\xFCr die Darmgesundheit.",description_hu:"T\xF6bb t\xF6rzset tartalmaz\xF3 probiotikum a b\xE9lfl\xF3ra eg\xE9szs\xE9g\xE9\xE9rt.",description_en:"Multi-strain probiotic for gut health.",description_preview_de:"Darmgesundheit Probiotikum",description_preview_hu:"B\xE9lfl\xF3ra probiotikum",description_preview_en:"Gut health probiotic",price_huf:"5490",price_usd:"15",price_eur:"14",times_ordered:"198",stock:"34",sale_percentage:"0",category:"supplements",manufacturer:"Biocodex",brand:"FloraBalance",rating:"4.4",sku:"PROB-COMP-30",active_ingredients:"Lactobacillus, Bifidobacterium",packaging:"30 kapszula",created_at:"2024-02-05",updated_at:"2024-03-10",name:"Probiotikum Komplex"},{id:"8",name_de:"Omega-3 Fisch\xF6l Kapseln",name_hu:"Omega-3 Halolaj Kapszula",name_en:"Omega-3 Fish Oil Capsules",description_de:"Premium Omega-3 Fetts\xE4uren f\xFCr Herz und Gehirn.",description_hu:"Pr\xE9mium Omega-3 zs\xEDrsavak a sz\xEDv \xE9s agy eg\xE9szs\xE9g\xE9\xE9rt.",description_en:"Premium Omega-3 fatty acids for heart and brain health.",description_preview_de:"Herz- und Gehirngesundheit",description_preview_hu:"Sz\xEDv \xE9s agy eg\xE9szs\xE9g",description_preview_en:"Heart and brain health",price_huf:"4290",price_usd:"12",price_eur:"11",times_ordered:"278",stock:"56",sale_percentage:"10",category:"supplements",manufacturer:"Nordic Naturals",brand:"OmegaPlus",rating:"4.6",sku:"OMG3-120",active_ingredients:"EPA, DHA",packaging:"120 kapszula",created_at:"2024-01-18",updated_at:"2024-03-01",name:"Omega-3 Halolaj"},{id:"9",name_de:"Babycreme Sensitive",name_hu:"Babakr\xE9m Sensitive",name_en:"Baby Cream Sensitive",description_de:"Sanfte Pflege f\xFCr empfindliche Babyhaut.",description_hu:"Gyeng\xE9d \xE1pol\xE1s \xE9rz\xE9keny babab\u0151rre.",description_en:"Gentle care for sensitive baby skin.",description_preview_de:"Sanfte Babyhautpflege",description_preview_hu:"Gyeng\xE9d babab\u0151r \xE1pol\xE1s",description_preview_en:"Gentle baby skin care",price_huf:"1990",price_usd:"6",price_eur:"5",times_ordered:"134",stock:"78",sale_percentage:"0",category:"baby-care",manufacturer:"Penaten",brand:"BabySoft",rating:"4.8",sku:"BABY-CREAM-100",active_ingredients:"Pantenol, Kamilla kivonat",packaging:"100ml kr\xE9m",created_at:"2024-02-10",updated_at:"2024-03-15",name:"Babakr\xE9m Sensitive"},{id:"10",name_de:"Magn\xE9sium 375mg Tabletten",name_hu:"Magn\xE9zium 375mg Tabletta",name_en:"Magnesium 375mg Tablets",description_de:"Magnesium f\xFCr Muskeln, Nerven und Energiestoffwechsel.",description_hu:"Magn\xE9zium az izmok, idegek \xE9s energiaanyagcsere t\xE1mogat\xE1s\xE1ra.",description_en:"Magnesium for muscles, nerves and energy metabolism.",description_preview_de:"Muskeln und Nervensystem",description_preview_hu:"Izmok \xE9s idegrendszer",description_preview_en:"Muscles and nervous system",price_huf:"2790",price_usd:"8",price_eur:"7",times_ordered:"321",stock:"92",sale_percentage:"0",category:"supplements",manufacturer:"Pharma Nord",brand:"MagPower",rating:"4.5",sku:"MAG-375-90",active_ingredients:"Magn\xE9zium-citr\xE1t",packaging:"90 tabletta",created_at:"2024-01-22",updated_at:"2024-03-08",name:"Magn\xE9zium 375mg"},{id:"11",name_de:"Digitales Fieberthermometer",name_hu:"Digit\xE1lis L\xE1zm\xE9r\u0151",name_en:"Digital Fever Thermometer",description_de:"Schnelles und genaues digitales Thermometer.",description_hu:"Gyors \xE9s pontos digit\xE1lis h\u0151m\xE9r\u0151.",description_en:"Fast and accurate digital thermometer.",description_preview_de:"Schnelle Temperaturmessung",description_preview_hu:"Gyors h\u0151m\xE9rs\xE9kletm\xE9r\xE9s",description_preview_en:"Fast temperature measurement",price_huf:"3990",price_usd:"11",price_eur:"10",times_ordered:"89",stock:"40",sale_percentage:"0",category:"medical-devices",manufacturer:"Omron",brand:"Omron",rating:"4.3",sku:"THERM-DIG-01",active_ingredients:"",packaging:"1 db",created_at:"2024-02-15",updated_at:"2024-03-12",name:"Digit\xE1lis L\xE1zm\xE9r\u0151"},{id:"12",name_de:"Nasenspray Meerwasser",name_hu:"Orrspray Tengerv\xEDz",name_en:"Nasal Spray Sea Water",description_de:"Nat\xFCrliches Meerwasser-Nasenspray zur Befeuchtung.",description_hu:"Term\xE9szetes tengervizes orrspray a ny\xE1lkah\xE1rtya hidrat\xE1l\xE1s\xE1ra.",description_en:"Natural sea water nasal spray for moisturizing.",description_preview_de:"Nat\xFCrliche Nasenpflege",description_preview_hu:"Term\xE9szetes orr\xE1pol\xE1s",description_preview_en:"Natural nasal care",price_huf:"1890",price_usd:"5",price_eur:"5",times_ordered:"210",stock:"65",sale_percentage:"15",category:"medicine",manufacturer:"Quixx",brand:"Quixx",rating:"4.4",sku:"NASAL-SEA-30",active_ingredients:"Tengerv\xEDz oldat",packaging:"30ml spray",created_at:"2024-01-28",updated_at:"2024-03-05",name:"Orrspray Tengerv\xEDz"}],E=class i{API_URL=v.baseURL;http=c(x);translationService=c(m);allProductsSignal=o([]);rawProducts=o([]);usingMockData=o(!1);filtersSignal=o({categories:[],priceRange:null,inStockOnly:!1,sortBy:"popularity"});currentPageSignal=o(1);itemsPerPageSignal=o(30);products=s(()=>this.allProductsSignal());currentFilters=s(()=>this.filtersSignal());isUsingMockData=s(()=>this.usingMockData());filteredProducts=s(()=>{let e=this.allProductsSignal(),t=this.filtersSignal();if(t.categories&&t.categories.length>0&&(e=e.filter(n=>t.categories.includes(n.category))),t.priceRange){let{min:n,max:r}=t.priceRange;e=e.filter(a=>{let l=a.price;return l>=n&&l<=r})}return t.inStockOnly&&(e=e.filter(n=>n.inStock)),t.sortBy&&(e=this.sortProducts(e,t.sortBy)),e});paginationState=s(()=>{let e=this.filteredProducts().length,t=this.itemsPerPageSignal(),n=this.currentPageSignal(),r=Math.ceil(e/t);return{currentPage:n,itemsPerPage:t,totalItems:e,totalPages:r}});paginatedProducts=s(()=>{let e=this.filteredProducts(),t=this.currentPageSignal(),n=this.itemsPerPageSignal(),r=(t-1)*n,a=r+n;return e.slice(r,a)});loadProducts(){return L(this,null,function*(){try{let e=yield F(this.getAllProducts()),t=this.translationService.getCurrentLanguage(),n=e.map(r=>w(r,t));this.rawProducts.set(e),this.allProductsSignal.set(n),this.usingMockData.set(!1),console.log(`Loaded ${e.length} products from backend`)}catch(e){console.warn("Backend unavailable, loading mock data:",e),this.loadMockProducts()}})}loadMockProducts(){let e=this.translationService.getCurrentLanguage(),t=g.map(r=>_(d({},r),{name_hu:`[TEST] ${r.name_hu}`,name_en:`[TEST] ${r.name_en}`,name_de:`[TEST] ${r.name_de}`,name:`[TEST] ${r.name}`})),n=t.map(r=>w(r,e));this.rawProducts.set(t),this.allProductsSignal.set(n),this.usingMockData.set(!0),console.log(`Loaded ${g.length} mock products (backend unavailable)`)}getFeaturedProducts(e=4){let t=this.translationService.getCurrentLanguage();return(this.rawProducts().length>0?this.rawProducts():g).filter(r=>parseFloat(r.stock)>0).sort((r,a)=>parseFloat(a.rating)-parseFloat(r.rating)).slice(0,e).map(r=>w(r,t))}getMockProducts(){return g}setFilters(e){this.filtersSignal.update(t=>d(d({},t),e)),this.currentPageSignal.set(1)}clearFilters(){this.filtersSignal.set({categories:[],priceRange:null,inStockOnly:!1,sortBy:"popularity"}),this.currentPageSignal.set(1)}setPage(e){let t=this.paginationState().totalPages;e>=1&&e<=t&&this.currentPageSignal.set(e)}setItemsPerPage(e){this.itemsPerPageSignal.set(e),this.currentPageSignal.set(1)}sortProducts(e,t){let n=[...e];switch(t){case"popularity":return n.sort((r,a)=>parseFloat(a.times_ordered)-parseFloat(r.times_ordered));case"price-asc":return n.sort((r,a)=>r.price-a.price);case"price-desc":return n.sort((r,a)=>a.price-r.price);case"name-asc":return n.sort((r,a)=>r.name.localeCompare(a.name));case"name-desc":return n.sort((r,a)=>a.name.localeCompare(r.name));case"rating":case"rating-desc":return n.sort((r,a)=>a.ratingNumber-r.ratingNumber);case"newest":return n.sort((r,a)=>new Date(a.created_at).getTime()-new Date(r.created_at).getTime());case"default":default:return n}}getAllProducts(){return this.http.get(`${this.API_URL}/api/get_all_products`).pipe(N(5e3),h(e=>{if(e.statuscode!=="200")throw new Error(`API Error: ${e.status}`);if(!e.products||!Array.isArray(e.products))throw new Error("Invalid API response: products array missing");return e.products}),f(this.handleError))}getProductById(e){return this.getAllProducts().pipe(h(t=>t.find(n=>n.id===e)),f(()=>{let t=g.find(n=>n.id===e);return b(t)}))}getProductsByCategory(e){return this.getAllProducts().pipe(h(t=>t.filter(n=>n.category===e)),f(()=>b(g.filter(t=>t.category===e))))}searchProducts(e){let t=e.toLowerCase();return this.getAllProducts().pipe(h(n=>n.filter(r=>r.name_en.toLowerCase().includes(t)||r.name_hu.toLowerCase().includes(t)||r.name_de.toLowerCase().includes(t))),f(()=>b(g.filter(n=>n.name_en.toLowerCase().includes(t)||n.name_hu.toLowerCase().includes(t)||n.name_de.toLowerCase().includes(t)))))}getSaleProducts(){return this.getAllProducts().pipe(h(e=>e.filter(t=>parseFloat(t.sale_percentage)>0)),f(()=>b(g.filter(e=>parseFloat(e.sale_percentage)>0))))}getInStockProducts(){return this.getAllProducts().pipe(h(e=>e.filter(t=>parseFloat(t.stock)>0)),f(()=>b(g.filter(e=>parseFloat(e.stock)>0))))}handleError(e){let t="An unknown error occurred";if(e.error instanceof ErrorEvent)t=`Error: ${e.error.message}`;else switch(e.status){case 400:t="Bad request";break;case 404:t="Products not found";break;case 500:t="Server error";break;default:t=`Error Code: ${e.status}
Message: ${e.message}`}return console.error("ProductService Error:",t),z(()=>new Error(t))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};var A=class i{translationService=c(m);currencyService=c(S);cartItems=o([]);items=this.cartItems.asReadonly();itemCount=s(()=>this.cartItems().reduce((e,t)=>e+t.quantity,0));totalPrice=s(()=>this.cartItems().reduce((e,t)=>{let n=this.getProductPrice(t.product),r=parseFloat(t.product.sale_percentage)||0,a=r>0?n*(1-r/100):n;return e+a*t.quantity},0));constructor(){this.loadCartFromStorage()}getProductPrice(e){switch(this.currencyService.getCurrentCurrencyCode()){case"HUF":return parseFloat(e.price_huf)||0;case"USD":return parseFloat(e.price_usd)||0;case"EUR":return parseFloat(e.price_eur)||0;default:return parseFloat(e.price_huf)||0}}getProductName(e){switch(this.translationService.getCurrentLanguage()){case"hu":return e.name_hu;case"en":return e.name_en;case"de":return e.name_de;default:return e.name_en}}getProductDescription(e,t=!1){let n=this.translationService.getCurrentLanguage();if(t)switch(n){case"hu":return e.description_preview_hu;case"en":return e.description_preview_en;case"de":return e.description_preview_de;default:return e.description_preview_en}switch(n){case"hu":return e.description_hu;case"en":return e.description_en;case"de":return e.description_de;default:return e.description_en}}addToCart(e,t=1){let n=this.cartItems().find(r=>r.product.id===e.id);n?this.updateQuantity(e.id,n.quantity+t):this.cartItems.update(r=>[...r,{product:e,quantity:t}]),this.saveCartToStorage()}removeFromCart(e){this.cartItems.update(t=>t.filter(n=>n.product.id!==e)),this.saveCartToStorage()}updateQuantity(e,t){if(t<=0){this.removeFromCart(e);return}this.cartItems.update(n=>n.map(r=>{if(r.product.id===e){let a=parseFloat(r.product.stock)||0;return _(d({},r),{quantity:Math.min(t,a)})}return r})),this.saveCartToStorage()}clearCart(){this.cartItems.set([]),this.saveCartToStorage()}isInCart(e){return this.cartItems().some(t=>t.product.id===e)}getItemQuantity(e){return this.cartItems().find(n=>n.product.id===e)?.quantity??0}saveCartToStorage(){try{localStorage.setItem("cart",JSON.stringify(this.cartItems()))}catch(e){console.error("Failed to save cart to localStorage:",e)}}loadCartFromStorage(){try{let e=localStorage.getItem("cart");if(e){let t=JSON.parse(e);this.cartItems.set(t)}}catch(e){console.error("Failed to load cart from localStorage:",e)}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a,S as b,E as c,A as d};
