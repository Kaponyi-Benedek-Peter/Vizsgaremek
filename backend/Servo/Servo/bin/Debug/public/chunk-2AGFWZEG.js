import{b as j}from"./chunk-ABTOR24V.js";import{e as O,g as L,k as I,n as V,p as T}from"./chunk-MXNZA3P6.js";import{$ as h,$a as u,Ba as o,Ja as g,Kb as c,Lb as d,Oa as C,S as M,Z as b,_ as E,aa as _,ab as v,ac as S,ec as k,ja as m,jb as t,kb as r,lb as f,mb as w,pb as P,qb as x,xb as s,yb as p,zb as y}from"./chunk-766VLGYE.js";function D(n,a){n&1&&(t(0,"div",2),f(1,"div",3),t(2,"h1"),s(3),c(4,"translate"),r(),t(5,"p",4),s(6),c(7,"translate"),r()()),n&2&&(o(3),p(d(4,2,"auth.login_promise.verifying")),o(3),p(d(7,4,"auth.login_promise.please_wait")))}function N(n,a){n&1&&(t(0,"div",2)(1,"div",5),h(),t(2,"svg",6),f(3,"path",7),r()(),_(),t(4,"h1"),s(5),c(6,"translate"),r(),t(7,"p",4),s(8),c(9,"translate"),r()()),n&2&&(o(5),p(d(6,2,"auth.login_promise.success_title")),o(3),p(d(9,4,"auth.login_promise.success_message")))}function U(n,a){if(n&1){let e=w();t(0,"div",2)(1,"div",8),h(),t(2,"svg",6),f(3,"path",9),r()(),_(),t(4,"h1"),s(5),c(6,"translate"),r(),t(7,"p",10),s(8),c(9,"translate"),r(),t(10,"button",11),P("click",function(){b(e);let l=x();return E(l.backToLogin())}),s(11),c(12,"translate"),r()()}if(n&2){let e=x();o(5),p(d(6,3,"auth.login_promise.error_title")),o(3),p(d(9,5,e.errorMessage())),o(3),y(" ",d(12,7,"auth.login_promise.back_to_login")," ")}}var B=class n{constructor(a,e,i){this.route=a;this.router=e;this.authService=i}location=M(S);isVerifying=m(!1);isSuccess=m(!1);errorMessage=m("");ngOnInit(){let e=(new URLSearchParams(window.location.search).get("login_promise")||"").split(";");if(e.length!==2){this.errorMessage.set("auth.errors.invalid_login_link");return}let i=e[0].trim(),l=e[1].trim();if(!i||!l){this.errorMessage.set("auth.errors.invalid_login_link");return}let R=`/login-promise?login_promise=${i};${l}`;this.location.replaceState(R);let A=sessionStorage.getItem("login_stay")==="1";sessionStorage.removeItem("login_stay"),this.completeLogin(i,l,A)}completeLogin(a,e,i){this.isVerifying.set(!0),this.errorMessage.set(""),this.authService.loginPromise(a,e,i).subscribe({next:()=>{this.isVerifying.set(!1),this.isSuccess.set(!0)},error:l=>{this.isVerifying.set(!1),this.errorMessage.set(l.message||"auth.errors.login_failed")}})}backToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(g(O),g(L),g(j))};static \u0275cmp=C({type:n,selectors:[["app-login-promise"]],decls:5,vars:3,consts:[[1,"auth-container"],[1,"auth-card"],[1,"verification-content"],[1,"spinner-large"],[1,"verification-text"],[1,"icon-wrapper","success"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["stroke-linecap","round","stroke-linejoin","round","d","M5 13l4 4L19 7"],[1,"icon-wrapper","error"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"verification-text","error-text"],[1,"submit-btn",3,"click"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"div",1),u(2,D,8,6,"div",2),u(3,N,10,6,"div",2),u(4,U,13,9,"div",2),r()()),e&2&&(o(2),v(i.isVerifying()?2:-1),o(),v(!i.isVerifying()&&i.isSuccess()?3:-1),o(),v(!i.isVerifying()&&i.errorMessage()?4:-1))},dependencies:[k,I,T,V],styles:[".auth-container[_ngcontent-%COMP%]{min-height:calc(100vh - 140px);display:flex;align-items:center;justify-content:center;padding:var(--space-6) var(--space-4);background:var(--bg-secondary)}.auth-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--radius-xl);box-shadow:var(--shadow-lg);padding:var(--space-10) var(--space-8);width:100%;max-width:480px;animation:_ngcontent-%COMP%_slideUp .4s ease-out}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.verification-content[_ngcontent-%COMP%]{text-align:center}.verification-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:clamp(1.25rem,3vw,1.6rem);font-weight:700;color:var(--text-primary);margin:var(--space-5) 0 var(--space-3)}.verification-text[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:var(--text-base, 1rem);line-height:1.6;margin-bottom:var(--space-6)}.error-text[_ngcontent-%COMP%]{color:#dc2626}.icon-wrapper[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;margin:0 auto var(--space-4);display:flex;align-items:center;justify-content:center}.icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:40px;height:40px}.icon-wrapper.success[_ngcontent-%COMP%]{background:#067a451f;color:#067a45}.icon-wrapper.error[_ngcontent-%COMP%]{background:#dc26261a;color:#dc2626}.spinner-large[_ngcontent-%COMP%]{width:56px;height:56px;border:4px solid var(--border-color);border-top-color:var(--color-primary);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin:0 auto var(--space-5)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.submit-btn[_ngcontent-%COMP%]{width:100%;padding:var(--space-3) var(--space-6);background:linear-gradient(135deg,#067a45,#048a4f);color:#fff;border:none;border-radius:var(--radius-lg);font-size:var(--text-base, 1rem);font-weight:600;cursor:pointer;transition:all var(--transition-fast, .15s);min-height:48px;margin-top:var(--space-2)}.submit-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #067a4566}"]})};export{B as LoginPromise};
