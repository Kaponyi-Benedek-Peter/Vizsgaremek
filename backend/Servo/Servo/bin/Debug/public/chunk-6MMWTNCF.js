import{b as j,m as E,q as R}from"./chunk-MXNZA3P6.js";import{K as L,N as h,Ob as s,R as O,S as g,a as d,b as m,c as S,da as M,h as F,ja as c,k as v,l as N,o as C,p as _,q as l,y as p}from"./chunk-766VLGYE.js";var f=class n{constructor(e){this.translate=e;this.initLanguage()}currentLangSubject=new F("en");currentLang$=this.currentLangSubject.asObservable();initLanguage(){let t=["hu","en","de"];this.translate.addLangs(t),this.translate.setDefaultLang("en");let a=this.getSavedLanguage()||"en";this.setLanguage(a)}setLanguage(e){this.translate.use(e),this.currentLangSubject.next(e),this.saveLanguage(e)}getCurrentLanguage(){return this.currentLangSubject.value}saveLanguage(e){localStorage.setItem("preferredLanguage",e)}getSavedLanguage(){return localStorage.getItem("preferredLanguage")}instant(e){return this.translate.instant(e)}static \u0275fac=function(t){return new(t||n)(O(E))};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};function A(n,e){let r=!e?.manualCleanup?e?.injector?.get(M)??g(M):null,a=V(e?.equal),i;e?.requireSync?i=c({kind:0},{equal:a}):i=c({kind:1,value:e?.initialValue},{equal:a});let o,b=n.subscribe({next:u=>i.set({kind:1,value:u}),error:u=>{i.set({kind:2,error:u}),o?.()},complete:()=>{o?.()}});if(e?.requireSync&&i().kind===0)throw new L(601,!1);return o=r?.onDestroy(b.unsubscribe.bind(b)),s(()=>{let u=i();switch(u.kind){case 1:return u.value;case 2:throw u.error;case 0:throw new L(601,!1)}},{equal:e?.equal})}function V(n=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&n(e.value,t.value)}var I=class n{translationService=g(f);currentLang=A(this.translationService.currentLang$,{initialValue:"en"});currencyMap={hu:{code:"HUF",symbol:"Ft",locale:"hu-HU"},en:{code:"USD",symbol:"$",locale:"en-US"},de:{code:"EUR",symbol:"\u20AC",locale:"de-DE"}};currentCurrency=s(()=>{let e=this.currentLang();return this.currencyMap[e]});formatPrice(e){let t=this.currentCurrency(),r=e.toLocaleString(t.locale,{minimumFractionDigits:0,maximumFractionDigits:2});return t.code==="HUF"?`${r} ${t.symbol}`:`${t.symbol}${r}`}getCurrencyForLanguage(e){return this.currencyMap[e]}getCurrentCurrencyCode(){return this.currentCurrency().code}getCurrentCurrencySymbol(){return this.currentCurrency().symbol}static \u0275fac=function(t){return new(t||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};function U(n){return{id:n.id,name_hu:n.category_hu,name_en:n.category_en,name_de:n.category_de,icon:n.emoji,color:n.color,count:0}}function k(n,e="hu",t=[]){let r=parseFloat(n.price_huf)||0,a=parseInt(n.stock)||0,i=parseFloat(n.sale_percentage)||0,o=parseFloat(n.rating)||0,b=a>0,u=i>0,q=!1,H=n.featured==="1",B=u?r*(1-i/100):r,y=n.name||"",P="";switch(e){case"hu":y=n.name_hu||n.name,P=n.description_hu||"";break;case"en":y=n.name_en||n.name,P=n.description_en||"";break;case"de":y=n.name_de||n.name,P=n.description_de||"";break}let w=n.thumbnail_url||"",W=t.length>0?t.sort((D,Q)=>parseInt(D.sort_id)-parseInt(Q.sort_id)).map(D=>D.image_url):w?[w]:[],z=n.category_id??n.category??"";return m(d({},n),{name:y,priceNumber:r,stockNumber:a,salePercentageNumber:i,ratingNumber:o,inStock:b,hasDiscount:u,requiresPrescription:q,isFeatured:H,price:B,discountPercentage:i,stockQuantity:a,reviewCount:0,category:z,nameHu:n.name_hu,nameEn:n.name_en,nameDe:n.name_de,description:P,descriptionHu:n.description_hu,descriptionEn:n.description_en,descriptionDe:n.description_de,activeIngredients:n.active_ingredients,imageUrl:w,images:W,dosage:void 0})}var T=class n{API_URL=R.baseURL;http=g(j);translationService=g(f);allProductsSignal=c([]);rawProducts=c([]);featuredSignal=c([]);categoriesSignal=c([]);loadingSignal=c(!1);errorSignal=c(null);filtersSignal=c({categories:[],priceRange:null,inStockOnly:!1,sortBy:"popularity"});currentPageSignal=c(1);itemsPerPageSignal=c(30);products=s(()=>this.allProductsSignal());featuredProducts=s(()=>this.featuredSignal());categories=s(()=>this.categoriesSignal());currentFilters=s(()=>this.filtersSignal());isLoading=s(()=>this.loadingSignal());error=s(()=>this.errorSignal());filteredProducts=s(()=>{let e=this.allProductsSignal(),t=this.filtersSignal();if(t.categories&&t.categories.length>0&&(e=e.filter(r=>t.categories.includes(r.category))),t.priceRange){let{min:r,max:a}=t.priceRange;e=e.filter(i=>i.price>=r&&i.price<=a)}return t.inStockOnly&&(e=e.filter(r=>r.inStock)),t.sortBy&&(e=this.sortProducts(e,t.sortBy)),e});paginationState=s(()=>{let e=this.filteredProducts().length,t=this.itemsPerPageSignal(),r=this.currentPageSignal(),a=Math.ceil(e/t);return{currentPage:r,itemsPerPage:t,totalItems:e,totalPages:a}});paginatedProducts=s(()=>{let e=this.filteredProducts(),t=this.currentPageSignal(),r=this.itemsPerPageSignal(),a=(t-1)*r;return e.slice(a,a+r)});loadProducts(){return S(this,null,function*(){this.loadingSignal.set(!0),this.errorSignal.set(null);try{let e=yield C(this.getAllProducts()),t=this.translationService.getCurrentLanguage(),r=this.buildCategoryIdMap(),a=e.map(o=>this.normalizeCategoryId(o,r)),i=a.map(o=>k(o,t));this.rawProducts.set(a),this.allProductsSignal.set(i),this.updateCategoryCounts(),console.log(`Loaded ${e.length} products from backend`)}catch(e){console.error("Failed to load products from backend:",e),this.errorSignal.set("products.error.load_failed"),this.allProductsSignal.set([]),this.rawProducts.set([])}finally{this.loadingSignal.set(!1)}})}loadFeaturedProducts(){return S(this,null,function*(){try{let e=yield C(this.getFeaturedFromApi()),t=this.translationService.getCurrentLanguage(),r=this.buildCategoryIdMap(),i=e.map(o=>this.normalizeCategoryId(o,r)).map(o=>k(o,t));this.featuredSignal.set(i),console.log(`Loaded ${e.length} featured products from backend`)}catch(e){let t=this.allProductsSignal().filter(r=>r.isFeatured);this.featuredSignal.set(t),console.warn("Featured products endpoint unavailable, using loaded products as fallback:",e)}})}loadCategories(){return S(this,null,function*(){try{let e=yield C(this.getAllCategories()),t=e.map(U);this.categoriesSignal.set(t),this.updateCategoryCounts(),console.log(`Loaded ${e.length} categories from backend`)}catch(e){console.error("Failed to load categories from backend:",e),this.categoriesSignal.set([])}})}setFilters(e){this.filtersSignal.update(t=>d(d({},t),e)),this.currentPageSignal.set(1)}clearFilters(){this.filtersSignal.set({categories:[],priceRange:null,inStockOnly:!1,sortBy:"popularity"}),this.currentPageSignal.set(1)}setPage(e){let t=this.paginationState().totalPages;e>=1&&e<=t&&this.currentPageSignal.set(e)}setItemsPerPage(e){this.itemsPerPageSignal.set(e),this.currentPageSignal.set(1)}getAllProducts(){return this.http.get(`${this.API_URL}/api/get_all_products`).pipe(_(5e3),l(e=>{if(e.statuscode!=="200")throw new Error(`API Error: ${e.status}`);if(!Array.isArray(e.products))throw new Error("Invalid products response");return e.products}),p(this.handleError))}getAllCategories(){return this.http.get(`${this.API_URL}/api/get_all_product_categories`).pipe(_(5e3),l(e=>{if(e.statuscode!=="200")throw new Error(`API Error: ${e.status}`);if(!Array.isArray(e.product_categories))throw new Error("Invalid categories response");return e.product_categories}),p(this.handleError))}getFeaturedFromApi(){return this.http.get(`${this.API_URL}/api/get_all_featured_products`).pipe(_(5e3),l(e=>{if(e.statuscode!=="200")throw new Error(`API Error: ${e.status}`);if(!Array.isArray(e.products))throw new Error("Invalid featured response");return e.products}),p(this.handleError))}getProductById(e){return this.getAllProducts().pipe(l(t=>t.find(r=>r.id===e)),p(()=>v(void 0)))}getProductsByCategory(e){return this.getAllProducts().pipe(l(t=>t.filter(r=>(r.category??r.category_id)===e)),p(()=>v([])))}getInStockProducts(){return this.getAllProducts().pipe(l(e=>e.filter(t=>parseInt(t.stock)>0)),p(()=>v([])))}searchProducts(e){let t=e.toLowerCase();return this.getAllProducts().pipe(l(r=>r.filter(a=>a.name_en.toLowerCase().includes(t)||a.name_hu.toLowerCase().includes(t)||a.name_de.toLowerCase().includes(t))),p(()=>v([])))}getSaleProducts(){return this.getAllProducts().pipe(l(e=>e.filter(t=>parseFloat(t.sale_percentage)>0)),p(()=>v([])))}buildCategoryIdMap(){let e=new Map;return this.categoriesSignal().forEach(t=>{e.set(t.id,t.id)}),e}updateCategoryCounts(){let e=this.allProductsSignal(),t=this.categoriesSignal();if(t.length===0)return;let r=new Map;e.forEach(i=>{let o=i.category_id??i.category??"";o&&r.set(o,(r.get(o)??0)+1)});let a=t.map(i=>m(d({},i),{count:r.get(i.id)??0}));this.categoriesSignal.set(a)}getCategoryById(e){return this.categoriesSignal().find(t=>t.id===e)}normalizeCategoryId(e,t){let r=e.category??e.category_id??"";return m(d({},e),{category:r})}sortProducts(e,t){let r=[...e];switch(t){case"popularity":return r.sort((a,i)=>parseFloat(i.times_ordered)-parseFloat(a.times_ordered));case"price-asc":return r.sort((a,i)=>a.price-i.price);case"price-desc":return r.sort((a,i)=>i.price-a.price);case"name-asc":return r.sort((a,i)=>a.name.localeCompare(i.name));case"name-desc":return r.sort((a,i)=>i.name.localeCompare(a.name));case"rating":case"rating-desc":return r.sort((a,i)=>i.ratingNumber-a.ratingNumber);case"newest":return r.sort((a,i)=>new Date(i.created_at).getTime()-new Date(a.created_at).getTime());default:return r}}handleError(e){let t="An unknown error occurred";return e.error instanceof ErrorEvent?t=e.error.message:t={400:"Bad request",404:"Not found",500:"Server error"}[e.status]??`Error ${e.status}: ${e.message}`,console.error("ProductService Error:",t),N(()=>new Error(t))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};var $=class n{translationService=g(f);currencyService=g(I);cartItems=c([]);items=this.cartItems.asReadonly();itemCount=s(()=>this.cartItems().reduce((e,t)=>e+t.quantity,0));totalPrice=s(()=>this.cartItems().reduce((e,t)=>{let r=this.getProductPrice(t.product),a=parseFloat(t.product.sale_percentage)||0,i=a>0?r*(1-a/100):r;return e+i*t.quantity},0));getProductPrice(e){switch(this.currencyService.currentCurrency().code){case"USD":return parseFloat(e.price_usd)||0;case"EUR":return parseFloat(e.price_eur)||0;default:return parseFloat(e.price_huf)||0}}constructor(){this.loadCartFromStorage()}getProductName(e){switch(this.translationService.getCurrentLanguage()){case"hu":return e.name_hu;case"en":return e.name_en;case"de":return e.name_de;default:return e.name_en}}getProductDescription(e,t=!1){let r=this.translationService.getCurrentLanguage();if(t)switch(r){case"hu":return e.description_preview_hu;case"en":return e.description_preview_en;case"de":return e.description_preview_de;default:return e.description_preview_en}switch(r){case"hu":return e.description_hu;case"en":return e.description_en;case"de":return e.description_de;default:return e.description_en}}addToCart(e,t=1){let r=this.cartItems().find(a=>a.product.id===e.id);r?this.updateQuantity(e.id,r.quantity+t):this.cartItems.update(a=>[...a,{product:e,quantity:t}]),this.saveCartToStorage()}removeFromCart(e){this.cartItems.update(t=>t.filter(r=>r.product.id!==e)),this.saveCartToStorage()}updateQuantity(e,t){if(t<=0){this.removeFromCart(e);return}this.cartItems.update(r=>r.map(a=>{if(a.product.id===e){let i=parseFloat(a.product.stock)||0;return m(d({},a),{quantity:Math.min(t,i)})}return a})),this.saveCartToStorage()}clearCart(){this.cartItems.set([]),this.saveCartToStorage()}isInCart(e){return this.cartItems().some(t=>t.product.id===e)}getItemQuantity(e){return this.cartItems().find(r=>r.product.id===e)?.quantity??0}saveCartToStorage(){try{localStorage.setItem("cart",JSON.stringify(this.cartItems()))}catch(e){console.error("Failed to save cart to localStorage:",e)}}loadCartFromStorage(){try{let e=localStorage.getItem("cart");if(e){let t=JSON.parse(e);this.cartItems.set(t)}}catch(e){console.error("Failed to load cart from localStorage:",e)}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};export{f as a,I as b,T as c,$ as d};
