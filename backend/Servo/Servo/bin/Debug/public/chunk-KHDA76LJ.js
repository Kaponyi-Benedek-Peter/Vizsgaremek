import{b as u}from"./chunk-SF2QL2AW.js";import{b as c,q as h}from"./chunk-MXNZA3P6.js";import{J as p,N as d,S as o,l as a,y as t}from"./chunk-766VLGYE.js";var m=class i{API_URL=h.baseURL;http=o(c);authService=o(u);getProfile(){return this.http.get(`${this.API_URL}/api/profile`).pipe(t(this.handleError))}updateProfile(e){let r={};return e.firstname&&(r.firstname=this.encodeBase64(e.firstname)),e.lastname&&(r.lastname=this.encodeBase64(e.lastname)),e.email&&(r.email=this.encodeBase64(e.email)),this.http.put(`${this.API_URL}/api/profile`,r).pipe(t(this.handleError))}deleteAccountRequest(e,r){let s={id:this.encodeBase64(e),password:this.encodeBase64(r)};return this.http.post(`${this.API_URL}/api/delacc_request`,s).pipe(t(this.handleError))}confirmAccountDeletion(e,r){let s={id:e,token:r};return this.http.post(`${this.API_URL}/api/delacc_promise`,s).pipe(p(()=>this.authService.logout()),t(this.handleError))}changePassword(e,r,s){let n={id:this.encodeBase64(e),currentPassword:this.encodeBase64(r),newPassword:this.encodeBase64(s)};return this.http.post(`${this.API_URL}/api/change-password`,n).pipe(t(this.handleError))}createOrder(e){return this.http.post(`${this.API_URL}/api/create_order`,e).pipe(t(this.handleError))}getOrderHistory(){return this.http.get(`${this.API_URL}/api/orders`).pipe(t(this.handleError))}getSavedAddresses(){return this.http.get(`${this.API_URL}/api/addresses`).pipe(t(this.handleError))}getAllUsersAdmin(){let e=this.buildAdminAuthBody();return this.http.post(`${this.API_URL}/api/get_all_users`,e).pipe(t(this.handleError))}getAllOrdersAdmin(){let e=this.buildAdminAuthBody();return this.http.post(`${this.API_URL}/api/get_all_orders`,e).pipe(t(this.handleError))}buildAdminAuthBody(){let e=sessionStorage.getItem("user_id")??"",r=this.authService.getSessionToken(),s=this.authService.getToken(),n=r??s??"";return{id:this.encodeBase64(e),session_token:this.encodeBase64(n)}}encodeBase64(e){try{return btoa(unescape(encodeURIComponent(e)))}catch{return btoa(e)}}handleError(e){let r="An unknown error occurred";if(e.error instanceof ErrorEvent)r=`Error: ${e.error.message}`;else switch(e.status){case 400:r="account.errors.bad_request";break;case 401:r="account.errors.unauthorized";break;case 403:r="account.errors.forbidden";break;case 404:r="account.errors.not_found";break;case 500:r="account.errors.server_error";break;default:r=e.error?.message||e.message||r}return a(()=>new Error(r))}static \u0275fac=function(r){return new(r||i)};static \u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
